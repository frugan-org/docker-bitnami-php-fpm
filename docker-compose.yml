services:

  php:
    container_name: ${PHP_NAME}
    build:
      context: ./${PHP_TAG}
      args:
        TAG: ${PHP_TAG}
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    networks:
      - default
    environment:
      APP_ENV: ${APP_ENV}
      USER_ID: ${USER_ID}
      GROUP_ID: ${GROUP_ID}
      TZ:  ${PHP_TZ}
      PHP_WAITFORIT_CONTAINER_NAME: ${PHP_WAITFORIT_CONTAINER_NAME}
      PHP_WAITFORIT_CONTAINER_PORT: ${PHP_WAITFORIT_CONTAINER_PORT}
      GITHUB_TOKEN: ${GITHUB_TOKEN}
      NEWRELIC_ENABLED: ${NEWRELIC_ENABLED}
      NEWRELIC_VERSION: ${NEWRELIC_VERSION}
      PHP_WITH_ALL_LOCALES: ${PHP_WITH_ALL_LOCALES}
      PHP_EXTRA_LOCALES: ${PHP_EXTRA_LOCALES}
      PHP_COMPOSER_GLOBAL_LIBS: ${PHP_COMPOSER_GLOBAL_LIBS}
      PHP_COMPOSER_PATHS: ${PHP_COMPOSER_PATHS}
      PHP_COMPOSER_VERSION: ${PHP_COMPOSER_VERSION}
      PHP_COMPOSER_ARG: ${PHP_COMPOSER_ARG}
      COMPOSER_ALLOW_SUPERUSER: 1
      COMPOSER_PROCESS_TIMEOUT: ${PHP_COMPOSER_PROCESS_TIMEOUT}
      PHP_WP_CLI_ENABLED: ${PHP_WP_CLI_ENABLED}
      PHP_APCU_ENABLED: ${PHP_APCU_ENABLED}
      PHP_MCRYPT_ENABLED: ${PHP_MCRYPT_ENABLED}
      PHP_IMAGICK_ENABLED: ${PHP_IMAGICK_ENABLED}
      PHP_IMAGICK_POLICY_RULES: ${PHP_IMAGICK_POLICY_RULES}
      PHP_MAXMINDDB_ENABLED: ${PHP_MAXMINDDB_ENABLED}
      PHP_MONGODB_ENABLED: ${PHP_MONGODB_ENABLED}
      PHP_XDEBUG_ENABLED: ${PHP_XDEBUG_ENABLED}
      PHP_MEMCACHED_ENABLED: ${PHP_MEMCACHED_ENABLED}
      PHP_PDO_DBLIB_ENABLED: ${PHP_PDO_DBLIB_ENABLED}
      PHP_PDO_PGSQL_ENABLED: ${PHP_PDO_PGSQL_ENABLED}
      PHP_PGSQL_ENABLED: ${PHP_PGSQL_ENABLED}
      PHP_OPCACHE_ENABLED: ${PHP_OPCACHE_ENABLED}
      PHP_SODIUM_ENABLED: ${PHP_SODIUM_ENABLED}
      PHP_REDIS_ENABLED: ${PHP_REDIS_ENABLED}
      PHP_IGBINARY_ENABLED: ${PHP_IGBINARY_ENABLED}
      PHP_MSGPACK_ENABLED: ${PHP_MSGPACK_ENABLED}
      PHP_SUPERCRONIC_ENABLED: ${PHP_SUPERCRONIC_ENABLED}
      PHP_SUPERCRONIC_FLAGS: ${PHP_SUPERCRONIC_FLAGS}
      SENTRY_DSN: ${PHP_SENTRY_DSN}
      PHP_JIT_BUFFER_SIZE: ${PHP_JIT_BUFFER_SIZE}
      PHP_SENDMAIL_PATH: ${PHP_SENDMAIL_PATH}

  mailpit:
    container_name: ${MAILPIT_NAME}
    image: axllent/mailpit:${MAILPIT_TAG:-latest}
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    ports:
      - ${MAILPIT_HTTP_PORT}:8025
      - ${MAILPIT_SMTP_PORT}:1025
    environment:
      MP_MAX_MESSAGES: ${MAILPIT_MAX_MESSAGES:-5000}
      MP_SMTP_AUTH_ACCEPT_ANY: ${MAILPIT_SMTP_AUTH_ACCEPT_ANY:-false}
      MP_SMTP_AUTH_ALLOW_INSECURE: ${MAILPIT_SMTP_AUTH_ALLOW_INSECURE:-false}
      MP_SMTP_REQUIRE_TLS: ${MAILPIT_SMTP_REQUIRE_TLS:-false}
      MP_SMTP_AUTH: ${MAILPIT_SMTP_AUTH:-}
    networks:
      - default
